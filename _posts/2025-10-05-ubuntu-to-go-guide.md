---
title: "打造即插即用的Ubuntu移动工作站：外置硬盘安装终极指南"
date: 2025-10-05 23:30:00 +0800
author: Bathelor
category: Linux系统
tags: [Ubuntu, Windows, 移动工作站, Hyper-V, 硬盘分区, UEFI, MBR]
---

### **前言：为何选择外置硬盘安装 Ubuntu**

在软件开发、数据科学和学习研究中，Linux 系统以其强大的命令行工具、开源生态和稳定性备受青睐。然而，许多用户的主力设备仍是 Windows。传统的双系统方案会修改本机硬盘的引导，存在一定风险；而虚拟机（VM）虽然安全，却无法完全发挥硬件的全部性能。

本文旨在提供一种两全其美的终极解决方案：将一个完整、高性能的 Ubuntu 系统安装到外置固态硬盘（SSD）上。这不仅能实现物理隔离，确保本机 Windows 系统绝对安全，还能让你的个人工作环境随身携带，真正做到“即插即用”。

### **核心优势：为何这是最佳方案**

1.  **绝对安全**：整个安装过程不触及本机硬盘的任何数据或引导分区。即使安装失败，也绝不会影响你现有的 Windows 系统。
2.  **极致便携**：你的个人开发环境、所有工具链、代码和数据都存储于外置硬盘中。你可以在任何支持 UEFI 启动的电脑上插入它，启动进入你熟悉的 Ubuntu 系统，实现真正的移动办公。
3.  **完整性能**：与在 Windows 上运行虚拟机不同，这种方式是在外置硬盘上进行“裸机”安装。Ubuntu 系统可以直接调用硬件资源（CPU、GPU、内存），性能几乎无损耗，尤其适合编译、渲染、模型训练等重度计算任务。
4.  **数据与环境隔离**：将工作（Linux）与娱乐（Windows）环境物理隔离，互不干扰，管理更加清晰。

### **第一章：规划与准备工作**

1.  **一台 Windows 主机**: 推荐 Windows 10/11 专业版或更高版本，以便使用 Hyper-V。
2.  **一个外置硬盘**: 强烈推荐使用 NVMe SSD 搭配 USB 3.1/3.2 硬盘盒，以获得最佳的 I/O 性能。本文以一块 477GB 的 NVMe SSD 为例。
3.  **Ubuntu ISO 镜像文件**: 从 Ubuntu 官网下载桌面版镜像。推荐选择 LTS (Long-Term Support) 版本，如 `ubuntu-20.04.6-desktop-amd64.iso`，以获得长期的稳定支持。
4.  **DiskGenius**：一款功能强大的 Windows 磁盘分区及数据恢复软件。
5.  **Hyper-V**：Windows 10/11 专业版及以上版本内建的虚拟机平台。

### **第二章：外置硬盘分区实战**

此步骤至关重要，我们将预先规划好所有分区，为后续安装铺平道路。

#### **2.1 分区方案详解**

| 用途 | 格式 (文件系统) | 大小 | 技术说明 |
| :--- | :--- | :--- | :--- |
| **EFI 系统分区 (ESP)** | FAT32 (VFAT) | 1 GB | UEFI 规范标准格式，用于存储 GRUB2 EFI 引导程序 (`grubx64.efi` 等)，是实现跨电脑启动的核心。 |
| **Swap 交换分区** | Linux Swap | 16 GB | 当物理内存(RAM)不足时，由内核用于数据交换的专用空间，没有文件系统结构。 |
| **/** **(根) 分区** | EXT4 | 100 GB | 现代 Linux 标准日志文件系统，用于存放系统核心文件和通过包管理器安装的软件。 |
| **/home 分区** | EXT4 | ~310 GB | 独立存放用户个人数据、配置、软件（如 Anaconda），便于系统重装时保留数据。 |
| **Shared 共享区** | NTFS | 剩余空间 | Windows 原生文件系统，通过 `ntfs-3g` 驱动可在 Linux 下完美读写，实现双系统文件交换。|

#### **2.2 MBR 与 GPT 分区表的关键差异与解决方案**

在分区时，你可能会遇到 **“主分区数量已达上限”** 的错误提示。这是因为硬盘当前使用了传统的 **MBR (Master Boot Record)** 分区表。

* **MBR 的限制**: MBR 将分区信息存储在主引导记录的 64 字节中，最多只支持 4 个主分区条目。
* **解决方案**: 为了突破 4 个分区的限制，MBR 引入了扩展分区的概念。我们将一个主分区条目标记为“扩展分区”，它本身不存储数据，而是作为一个容器，内部可以划分出多个逻辑分区。
    1.  将 **EFI 分区** 创建为 **主分区 (Primary)**。
    2.  将剩余的全部空间创建为一个 **扩展分区 (Extended)**。
    3.  在扩展分区内部，再依次创建 `Swap`, `/`, `/home`, `Shared` 这四个 **逻辑分区 (Logical)**。

如果你的硬盘是现代的 **GPT (GUID Partition Table)** 格式，则没有这个限制，它理论上支持无限个分区（通常实现为 128 个），所有分区都可以直接创建。

### **第三章：使用 Hyper-V 安全安装 Ubuntu**

为了实现绝对的物理隔离，避免误操作本机硬盘，我们选择在虚拟机中进行安装。

#### **3.1 为何选择 Hyper-V**

最初尝试使用 VMware Workstation 时，遇到了无法识别 USB 外置硬盘的顽固问题。这通常与 VMware 的 USB 服务 (`VMware USB Arbitration Service`) 和主机系统的深层冲突有关。为了绕过这些复杂的兼容性问题，直接使用 Windows 内建的 Hyper-V 是更稳定、更高效的选择。

#### **3.2 配置 Hyper-V 实现硬盘直通**

1.  **启用 Hyper-V**：在「启用或关闭 Windows 功能」中，勾选 `Hyper-V` 及其所有子选项，特别是 `Hyper-V 平台`。完成后重启。
2.  **设置硬盘直通 (Pass-through Disk)**：
    * **原理**：为了让虚拟机内的 Ubuntu 安装程序能直接访问物理硬盘并修改分区表，我们需要绕过 Windows 的文件系统层，将整个物理磁盘的底层访问权限（`\\.\PhysicalDriveX`）交给虚拟机。
    * **操作**：在「磁盘管理」(`diskmgmt.msc`) 中，右键点击你的外置硬盘（如“磁盘2”），选择**「脱机」**。此操作会卸载 Windows 对该硬盘的所有卷，将控制权释放出来。
3.  **创建与配置虚拟机**：
    * 在 Hyper-V 管理器中，创建一台**第二代**虚拟机。第二代虚拟机使用 UEFI 固件，与我们创建的 EFI 分区兼容。
    * 在虚拟机设置中，将外接硬盘以 **“物理硬盘”** 的方式新增到 SCSI 控制器。
    * 手动新增一个 **DVD 驱动器**，并加载你的 Ubuntu ISO 镜像文件。
    * 调整「固件」中的启动顺序，确保 DVD 驱动器在第一位。

#### **3.3 解决 Hyper-V 常见启动错误**

* **安全启动 (Secure Boot) 错误**：
    * **错误信息**：`The signed image's hash is not allowed (DB)`
    * **技术原因**：Hyper-V 默认的 UEFI 安全启动策略只信任微软的签名密钥。Ubuntu 的引导程序 (shim) 虽然由微软的第三方 CA 签名，但需要更宽容的策略。`DB` 指的是 UEFI 固件中的“签名数据库”。
    * **解决**：在虚拟机「设置」->「安全」中，将安全启动的模板从 "Microsoft Windows" 改为 **"Microsoft UEFI Certificate Authority"**。

* **检查点 (Checkpoint) 错误**：
    * **错误信息**：`检查点操作失败，无法创建生产检查点`
    * **技术原因**：默认的“生产检查点”依赖于宿主机与虚拟机内部 VSS (卷影复制服务) 的协作来创建应用一致性快照。在系统未安装时，虚拟机内部无 VSS 服务响应，导致失败。
    * **解决**：在虚拟机「设置」->「检查点」中，**取消勾选「启用检查点」**，或将其类型改为“标准检查点”（它只保存内存和设备状态，不依赖虚拟机内部服务）。

### **第四章：Ubuntu 安装程序的手动分区**

启动虚拟机后，进入 Ubuntu 安装程序。在「安装类型」页面，务必选择 **“其他选项”**。此时，你应该能看到之前用 DiskGenius 创建的所有分区。

![手动分区界面的初始状态](/assets/images/posts/ubuntu-install-step1.png)

1.  **EFI 分区** (`/dev/sda1`)：选择 FAT32 分区，「用于」选择 **“EFI 系统分区”**。
2.  **Swap 分区** (`/dev/sda5`)：选择 17.2 GB 的分区，「用于」选择 **“交换空间 (swap area)”**。
3.  **根分区** (`/dev/sda6`)：选择 107.4 GB 的 EXT4 分区，「用于」选择 **“Ext4 日志文件系统”**，「挂载点」选择 **`/`**，并**勾选**「格式化分区」。
4.  **Home 分区** (`/dev/sda7`)：选择 332.9 GB 的 EXT4 分区，「用于」选择 **“Ext4 日志文件系统”**，「挂载点」选择 **`/home`**，并**勾选**「格式化分区」。
5.  **【核心步骤】** 在底部“安装启动引导器的设备”下拉菜单中，务必选择你的 **EFI 分区**（如 `/dev/sda1`）。此操作会将 GRUB2 引导程序 (`grubx64.efi`) 安装到该分区的 `\EFI\ubuntu` 目录下，任何支持 UEFI 的电脑都能通过它启动你的系统。

完成所有设置后，界面应如下图所示。仔细检查无误后，即可点击“现在安装”。

![完成所有挂载点设置后的最终确认界面](/assets/images/posts/ubuntu-install-step2.png)

### **第五章：首次启动与收尾配置**

1.  **从外置硬盘启动 Ubuntu**：
    重启电脑，在开机时按下特定键（如 F12, F10, Esc, Del）进入主板固件的“启动菜单 (Boot Menu)”，选择识别出的外置硬盘（通常会以 UEFI 开头）即可进入 Ubuntu。

2.  **在 Windows 中整理盘符**：
    * 将外置硬盘插回 Windows，它可能仍是「脱机」状态。在「磁盘管理」中，右键点击该磁盘，选择 **「联机」**。
    * 此时 `Shared` 和 `efi` 分区都会获得盘符。为避免误操作，需隐藏 `efi` 分区。
    * 在「磁盘管理」中，右键点击 `efi` 分区，选择「更改驱动器号和路径」，然后点击「删除」。此操作仅修改 Windows 注册表中的卷挂载点 (`HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices`)，不会影响分区数据，且对本机具有记忆效应。

3.  **在 Ubuntu 中访问共享分区**：
    * 进入 Ubuntu 桌面后，打开「文件」App (Nautilus)。
    * Ubuntu 会通过 `ntfs-3g` 驱动自动识别 NTFS 分区。在左侧点击你的 `Shared` 分区即可自动挂载到 `/media/<你的用户名>/Shared` 路径下。
    * 你可以将它从侧边栏直接拖到桌面上，创建一个 `.desktop` 快捷方式，方便日后使用。

### **结语**

虽然过程中遇到了一些意想不到的挑战，但通过逐一排查，最终我们成功打造了一个稳定、高效且可携带的 Ubuntu To Go 系统。它不仅满足了开发需求，也实现了与 Windows 的完美共存和文件交换。希望这份详细的技术记录能帮助到有同样需求的你。

### **参考文献**

* **移动硬盘制作Ubuntu系统盘 - CSDN App**: [https://t.csdnimg.cn/jJnO1](https://t.csdnimg.cn/jJnO1)
